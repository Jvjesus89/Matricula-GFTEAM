[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[dev]
  command = "npm run dev"
  port = 8888
  targetPort = 5173
  publish = "."

[build.environment]
  NODE_VERSION = "18"
  NETLIFY_USE_YARN = "false"
  NETLIFY_FUNCTIONS_LOG = "true"

[[plugins]]
package = "@netlify/plugin-functions-install-core"

# Configuração do cron job para verificar vencimentos
[functions.verificarVencimentos]
schedule = "0 12 * * *" # Executa todos os dias às 12:00 UTC (09:00 BRT)

# Configuração do cron job para processar lançamentos mensais
# Executa nos primeiros 5 dias do mês às 08:00 UTC (05:00 BRT) como backup
# Isso garante que mesmo se falhar no dia 01, os lançamentos serão criados
# A função já verifica se os lançamentos já existem, então é seguro executar múltiplas vezes
[functions.processarLancamentosMensais]
schedule = "0 8 1-5 * *" # Executa nos dias 01-05 de cada mês às 08:00 UTC (05:00 BRT)

# Configurações adicionais para funções
[functions]
  node_bundler = "esbuild"
  external_node_modules = ["@supabase/supabase-js", "axios"] 